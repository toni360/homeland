<?php
/**
 * @name PublicController
 * @author xuebingwang
 * @desc Public控制器
 * @see http://www.php.net/manual/en/class.yaf-controller-abstract.php
*/
class PublicController extends MallController {

    public function loginAction(){
        if(!is_not_wx()){
            $this->error('您还没有关注我们的公众号,请先关注!','http://mp.weixin.qq.com/s?__biz=MzI3NjAxNzE3OA==&mid=208969297&idx=1&sn=9a49f2e1409e79d1168125f97d580f6a&scene=5#rd');
        }
    }

    public function registerAction(){
        if(IS_POST){
            if(M('t_company')->get('id',['unionid'=>$this->user['unionid']])){
                $this->error('对不起，您已经申请过了，无需再次申请！');
            }
            $data = [];
            $data['company'] = trim($this->getRequest()->getPost('company'));
            if($data['company'] == ''){
                $this->error('企业名称不能为空！');
            }
            $data['corporation'] = trim($this->getRequest()->getPost('corporation'));
            if($data['corporation'] == ''){
                $this->error('法人姓名不能为空！');
            }
            $data['mobile'] = trim($this->getRequest()->getPost('mobile'));
            if($data['mobile'] == ''){
                $this->error('手机号码不能为空！');
            }
            $data['district'] = intval($this->getRequest()->getPost('district'));
            if($data['district'] == ''){
                $this->error('请选择您所在的地区！');
            }
            $city = $this->getRequest()->getPost('city');
            if(empty($city)){
                $this->error('请选择您所在的地区！');
            }
            $city = explode('|',$city);

            $data['province'] = $city[0];
            $data['city'] = isset($city[1]) ? $city[1] : '';

            $data['unionid'] = $this->user['unionid'];
            $data['insert_time'] = time_format();

            if(M('t_company')->insert($data)){
                $this->success('申请成功！');
            }else{
                $this->error('申请失败，请重新再试！');
            }
        }

    }

    public function forgetAction(){

    }

    public function createWxMenu2Action(){

        $this->wechat = new Wechat($this->config->wechat->toArray());

        $base_url = 'http://ttdh.fengniao.info/';
        $newmenu =  [
            "button"=>[
                [
                    'name'=>'首页',
                    'type'=>'view',
                    'url'=>$this->wechat->getOauthRedirect($base_url.'callback/wxmenu','index'),
                ],
                [
                    'name'=>'家园课程',
                    'type'=>'view',
                    'url'=>$this->wechat->getOauthRedirect($base_url.'callback/wxmenu','class'),
                ],
                [
                    'name'=>'会员中心',
                    'type'=>'view',
                    'url'=>$this->wechat->getOauthRedirect($base_url.'callback/wxmenu','myinfo'),
                ]
            ]
        ];
        $result = $this->wechat->createMenu($newmenu);
        var_dump($result);die;
    }

    public function getcityAction(){

//        $data = [];
//
//        $sql = "select * from t_xbdistrict where `level` < 3";
//        foreach (M()->query($sql)->fetchAll(PDO::FETCH_ASSOC) as $tmp){
//            $data[$tmp['pid']][$tmp['id']] = array($tmp['id'],$tmp['name']);
//        }
//
//        $this->ajaxReturn($data,'json',JSON_UNESCAPED_UNICODE);
    }

    public function districtAction(){

        echo '{"0":{"10":["10","北京市"],"11":["11","天津市"],"12":["12","河北省"],"13":["13","山西省"],"14":["14","内蒙古自治区"],"15":["15","辽宁省"],"16":["16","吉林省"],"17":["17","黑龙江省"],"18":["18","上海市"],"19":["19","江苏省"],"20":["20","浙江省"],"21":["21","安徽省"],"22":["22","福建省"],"23":["23","江西省"],"24":["24","山东省"],"25":["25","河南省"],"26":["26","湖北省"],"27":["27","湖南省"],"28":["28","广东省"],"29":["29","广西壮族自治区"],"30":["30","海南省"],"31":["31","重庆市"],"32":["32","四川省"],"33":["33","贵州省"],"34":["34","云南省"],"35":["35","西藏自治区"],"36":["36","陕西省"],"37":["37","甘肃省"],"38":["38","青海省"],"39":["39","宁夏回族自治区"],"40":["40","新疆维吾尔自治区"],"41":["41","台湾省"],"42":["42","香港特别行政区"],"43":["43","澳门特别行政区"],"44":["44","海外"],"45":["45","其他"]},"10":{"1010":["1010","东城区"],"1011":["1011","西城区"],"1012":["1012","崇文区"],"1013":["1013","宣武区"],"1014":["1014","朝阳区"],"1015":["1015","丰台区"],"1016":["1016","石景山区"],"1017":["1017","海淀区"],"1018":["1018","门头沟区"],"1019":["1019","房山区"],"1020":["1020","通州区"],"1021":["1021","顺义区"],"1022":["1022","昌平区"],"1023":["1023","大兴区"],"1024":["1024","怀柔区"],"1025":["1025","平谷区"],"1026":["1026","密云县"],"1027":["1027","延庆县"]},"11":{"1110":["1110","和平区"],"1111":["1111","河东区"],"1112":["1112","河西区"],"1113":["1113","南开区"],"1114":["1114","河北区"],"1115":["1115","红桥区"],"1116":["1116","塘沽区"],"1117":["1117","汉沽区"],"1118":["1118","大港区"],"1119":["1119","东丽区"],"1120":["1120","西青区"],"1121":["1121","津南区"],"1122":["1122","北辰区"],"1123":["1123","武清区"],"1124":["1124","宝坻区"],"1125":["1125","宁河县"],"1126":["1126","静海县"],"1127":["1127","蓟县"]},"12":{"1210":["1210","石家庄市"],"1211":["1211","唐山市"],"1212":["1212","秦皇岛市"],"1213":["1213","邯郸市"],"1214":["1214","邢台市"],"1215":["1215","保定市"],"1216":["1216","张家口市"],"1217":["1217","承德市"],"1218":["1218","衡水市"],"1219":["1219","廊坊市"],"1220":["1220","沧州市"]},"13":{"1310":["1310","太原市"],"1311":["1311","大同市"],"1312":["1312","阳泉市"],"1313":["1313","长治市"],"1314":["1314","晋城市"],"1315":["1315","朔州市"],"1316":["1316","晋中市"],"1317":["1317","运城市"],"1318":["1318","忻州市"],"1319":["1319","临汾市"],"1320":["1320","吕梁市"]},"14":{"1410":["1410","呼和浩特市"],"1411":["1411","包头市"],"1412":["1412","乌海市"],"1413":["1413","赤峰市"],"1414":["1414","通辽市"],"1415":["1415","鄂尔多斯市"],"1416":["1416","呼伦贝尔市"],"1417":["1417","巴彦淖尔市"],"1418":["1418","乌兰察布市"],"1419":["1419","兴安盟"],"1420":["1420","锡林郭勒盟"],"1421":["1421","阿拉善盟"]},"15":{"1510":["1510","沈阳市"],"1511":["1511","大连市"],"1512":["1512","鞍山市"],"1513":["1513","抚顺市"],"1514":["1514","本溪市"],"1515":["1515","丹东市"],"1516":["1516","锦州市"],"1517":["1517","营口市"],"1518":["1518","阜新市"],"1519":["1519","辽阳市"],"1520":["1520","盘锦市"],"1521":["1521","铁岭市"],"1522":["1522","朝阳市"],"1523":["1523","葫芦岛市"]},"16":{"1610":["1610","长春市"],"1611":["1611","吉林市"],"1612":["1612","四平市"],"1613":["1613","辽源市"],"1614":["1614","通化市"],"1615":["1615","白山市"],"1616":["1616","松原市"],"1617":["1617","白城市"],"1618":["1618","延边朝鲜族自治州"]},"17":{"1710":["1710","哈尔滨市"],"1711":["1711","齐齐哈尔市"],"1712":["1712","鸡西市"],"1713":["1713","鹤岗市"],"1714":["1714","双鸭山市"],"1715":["1715","大庆市"],"1716":["1716","伊春市"],"1717":["1717","佳木斯市"],"1718":["1718","七台河市"],"1719":["1719","牡丹江市"],"1720":["1720","黑河市"],"1721":["1721","绥化市"],"1722":["1722","大兴安岭地区"]},"18":{"1810":["1810","黄浦区"],"1811":["1811","卢湾区"],"1812":["1812","徐汇区"],"1813":["1813","长宁区"],"1814":["1814","静安区"],"1815":["1815","普陀区"],"1816":["1816","闸北区"],"1817":["1817","虹口区"],"1818":["1818","杨浦区"],"1819":["1819","闵行区"],"1820":["1820","宝山区"],"1821":["1821","嘉定区"],"1822":["1822","浦东新区"],"1823":["1823","金山区"],"1824":["1824","松江区"],"1825":["1825","青浦区"],"1826":["1826","南汇区"],"1827":["1827","奉贤区"],"1828":["1828","崇明县"]},"19":{"1910":["1910","南京市"],"1911":["1911","无锡市"],"1912":["1912","徐州市"],"1913":["1913","常州市"],"1914":["1914","苏州市"],"1915":["1915","南通市"],"1916":["1916","连云港市"],"1917":["1917","淮安市"],"1918":["1918","盐城市"],"1919":["1919","扬州市"],"1920":["1920","镇江市"],"1921":["1921","泰州市"],"1922":["1922","宿迁市"]},"20":{"2010":["2010","杭州市"],"2011":["2011","宁波市"],"2012":["2012","温州市"],"2013":["2013","嘉兴市"],"2014":["2014","湖州市"],"2015":["2015","绍兴市"],"2016":["2016","舟山市"],"2017":["2017","衢州市"],"2018":["2018","金华市"],"2019":["2019","台州市"],"2020":["2020","丽水市"]},"21":{"2110":["2110","合肥市"],"2111":["2111","芜湖市"],"2112":["2112","蚌埠市"],"2113":["2113","淮南市"],"2114":["2114","马鞍山市"],"2115":["2115","淮北市"],"2116":["2116","铜陵市"],"2117":["2117","安庆市"],"2118":["2118","黄山市"],"2119":["2119","滁州市"],"2120":["2120","阜阳市"],"2121":["2121","宿州市"],"2122":["2122","巢湖市"],"2123":["2123","六安市"],"2124":["2124","亳州市"],"2125":["2125","池州市"],"2126":["2126","宣城市"]},"22":{"2210":["2210","福州市"],"2211":["2211","厦门市"],"2212":["2212","莆田市"],"2213":["2213","三明市"],"2214":["2214","泉州市"],"2215":["2215","漳州市"],"2216":["2216","南平市"],"2217":["2217","龙岩市"],"2218":["2218","宁德市"]},"23":{"2310":["2310","南昌市"],"2311":["2311","景德镇市"],"2312":["2312","萍乡市"],"2313":["2313","九江市"],"2314":["2314","新余市"],"2315":["2315","鹰潭市"],"2316":["2316","赣州市"],"2317":["2317","吉安市"],"2318":["2318","宜春市"],"2319":["2319","抚州市"],"2320":["2320","上饶市"]},"24":{"2410":["2410","济南市"],"2411":["2411","青岛市"],"2412":["2412","淄博市"],"2413":["2413","枣庄市"],"2414":["2414","东营市"],"2415":["2415","烟台市"],"2416":["2416","潍坊市"],"2417":["2417","济宁市"],"2418":["2418","泰安市"],"2419":["2419","威海市"],"2420":["2420","日照市"],"2421":["2421","莱芜市"],"2422":["2422","临沂市"],"2423":["2423","德州市"],"2424":["2424","聊城市"],"2425":["2425","滨州市"],"2426":["2426","菏泽市"]},"25":{"2510":["2510","郑州市"],"2511":["2511","开封市"],"2512":["2512","洛阳市"],"2513":["2513","平顶山市"],"2514":["2514","安阳市"],"2515":["2515","鹤壁市"],"2516":["2516","新乡市"],"2517":["2517","焦作市"],"2518":["2518","濮阳市"],"2519":["2519","许昌市"],"2520":["2520","漯河市"],"2521":["2521","三门峡市"],"2522":["2522","南阳市"],"2523":["2523","商丘市"],"2524":["2524","信阳市"],"2525":["2525","周口市"],"2526":["2526","驻马店市"],"2527":["2527","济源市"]},"26":{"2610":["2610","武汉市"],"2611":["2611","黄石市"],"2612":["2612","十堰市"],"2613":["2613","宜昌市"],"2614":["2614","襄樊市"],"2615":["2615","鄂州市"],"2616":["2616","荆门市"],"2617":["2617","孝感市"],"2618":["2618","荆州市"],"2619":["2619","黄冈市"],"2620":["2620","咸宁市"],"2621":["2621","随州市"],"2622":["2622","恩施土家族苗族自治州"],"2623":["2623","仙桃市"],"2624":["2624","潜江市"],"2625":["2625","天门市"],"2626":["2626","神农架林区"]},"27":{"2710":["2710","长沙市"],"2711":["2711","株洲市"],"2712":["2712","湘潭市"],"2713":["2713","衡阳市"],"2714":["2714","邵阳市"],"2715":["2715","岳阳市"],"2716":["2716","常德市"],"2717":["2717","张家界市"],"2718":["2718","益阳市"],"2719":["2719","郴州市"],"2720":["2720","永州市"],"2721":["2721","怀化市"],"2722":["2722","娄底市"],"2723":["2723","湘西土家族苗族自治州"]},"28":{"2810":["2810","广州市"],"2811":["2811","韶关市"],"2812":["2812","深圳市"],"2813":["2813","珠海市"],"2814":["2814","汕头市"],"2815":["2815","佛山市"],"2816":["2816","江门市"],"2817":["2817","湛江市"],"2818":["2818","茂名市"],"2819":["2819","肇庆市"],"2820":["2820","惠州市"],"2821":["2821","梅州市"],"2822":["2822","汕尾市"],"2823":["2823","河源市"],"2824":["2824","阳江市"],"2825":["2825","清远市"],"2826":["2826","东莞市"],"2827":["2827","中山市"],"2828":["2828","潮州市"],"2829":["2829","揭阳市"],"2830":["2830","云浮市"]},"29":{"2910":["2910","南宁市"],"2911":["2911","柳州市"],"2912":["2912","桂林市"],"2913":["2913","梧州市"],"2914":["2914","北海市"],"2915":["2915","防城港市"],"2916":["2916","钦州市"],"2917":["2917","贵港市"],"2918":["2918","玉林市"],"2919":["2919","百色市"],"2920":["2920","贺州市"],"2921":["2921","河池市"],"2922":["2922","来宾市"],"2923":["2923","崇左市"]},"30":{"3010":["3010","海口市"],"3011":["3011","三亚市"],"3012":["3012","五指山市"],"3013":["3013","琼海市"],"3014":["3014","儋州市"],"3015":["3015","文昌市"],"3016":["3016","万宁市"],"3017":["3017","东方市"],"3018":["3018","定安县"],"3019":["3019","屯昌县"],"3020":["3020","澄迈县"],"3021":["3021","临高县"],"3022":["3022","白沙黎族自治县"],"3023":["3023","昌江黎族自治县"],"3024":["3024","乐东黎族自治县"],"3025":["3025","陵水黎族自治县"],"3026":["3026","保亭黎族苗族自治县"],"3027":["3027","琼中黎族苗族自治县"],"3028":["3028","西沙群岛"],"3029":["3029","南沙群岛"],"3030":["3030","中沙群岛的岛礁及其海域"]},"31":{"3110":["3110","万州区"],"3111":["3111","涪陵区"],"3112":["3112","渝中区"],"3113":["3113","大渡口区"],"3114":["3114","江北区"],"3115":["3115","沙坪坝区"],"3116":["3116","九龙坡区"],"3117":["3117","南岸区"],"3118":["3118","北碚区"],"3119":["3119","双桥区"],"3120":["3120","万盛区"],"3121":["3121","渝北区"],"3122":["3122","巴南区"],"3123":["3123","黔江区"],"3124":["3124","长寿区"],"3125":["3125","綦江县"],"3126":["3126","潼南县"],"3127":["3127","铜梁县"],"3128":["3128","大足县"],"3129":["3129","荣昌县"],"3130":["3130","璧山县"],"3131":["3131","梁平县"],"3132":["3132","城口县"],"3133":["3133","丰都县"],"3134":["3134","垫江县"],"3135":["3135","武隆县"],"3136":["3136","忠县"],"3137":["3137","开县"],"3138":["3138","云阳县"],"3139":["3139","奉节县"],"3140":["3140","巫山县"],"3141":["3141","巫溪县"],"3142":["3142","石柱土家族自治县"],"3143":["3143","秀山土家族苗族自治县"],"3144":["3144","酉阳土家族苗族自治县"],"3145":["3145","彭水苗族土家族自治县"],"3146":["3146","江津市"],"3147":["3147","合川市"],"3148":["3148","永川市"],"3149":["3149","南川市"]},"32":{"3210":["3210","成都市"],"3211":["3211","自贡市"],"3212":["3212","攀枝花市"],"3213":["3213","泸州市"],"3214":["3214","德阳市"],"3215":["3215","绵阳市"],"3216":["3216","广元市"],"3217":["3217","遂宁市"],"3218":["3218","内江市"],"3219":["3219","乐山市"],"3220":["3220","南充市"],"3221":["3221","眉山市"],"3222":["3222","宜宾市"],"3223":["3223","广安市"],"3224":["3224","达州市"],"3225":["3225","雅安市"],"3226":["3226","巴中市"],"3227":["3227","资阳市"],"3228":["3228","阿坝藏族羌族自治州"],"3229":["3229","甘孜藏族自治州"],"3230":["3230","凉山彝族自治州"]},"33":{"3310":["3310","贵阳市"],"3311":["3311","六盘水市"],"3312":["3312","遵义市"],"3313":["3313","安顺市"],"3314":["3314","铜仁地区"],"3315":["3315","黔西南布依族苗族自治州"],"3316":["3316","毕节地区"],"3317":["3317","黔东南苗族侗族自治州"],"3318":["3318","黔南布依族苗族自治州"]},"34":{"3410":["3410","昆明市"],"3411":["3411","曲靖市"],"3412":["3412","玉溪市"],"3413":["3413","保山市"],"3414":["3414","昭通市"],"3415":["3415","丽江市"],"3416":["3416","思茅市"],"3417":["3417","临沧市"],"3418":["3418","楚雄彝族自治州"],"3419":["3419","红河哈尼族彝族自治州"],"3420":["3420","文山壮族苗族自治州"],"3421":["3421","西双版纳傣族自治州"],"3422":["3422","大理白族自治州"],"3423":["3423","德宏傣族景颇族自治州"],"3424":["3424","怒江傈僳族自治州"],"3425":["3425","迪庆藏族自治州"]},"35":{"3510":["3510","拉萨市"],"3511":["3511","昌都地区"],"3512":["3512","山南地区"],"3513":["3513","日喀则地区"],"3514":["3514","那曲地区"],"3515":["3515","阿里地区"],"3516":["3516","林芝地区"]},"36":{"3610":["3610","西安市"],"3611":["3611","铜川市"],"3612":["3612","宝鸡市"],"3613":["3613","咸阳市"],"3614":["3614","渭南市"],"3615":["3615","延安市"],"3616":["3616","汉中市"],"3617":["3617","榆林市"],"3618":["3618","安康市"],"3619":["3619","商洛市"]},"37":{"3710":["3710","兰州市"],"3711":["3711","嘉峪关市"],"3712":["3712","金昌市"],"3713":["3713","白银市"],"3714":["3714","天水市"],"3715":["3715","武威市"],"3716":["3716","张掖市"],"3717":["3717","平凉市"],"3718":["3718","酒泉市"],"3719":["3719","庆阳市"],"3720":["3720","定西市"],"3721":["3721","陇南市"],"3722":["3722","临夏回族自治州"],"3723":["3723","甘南藏族自治州"]},"38":{"3810":["3810","西宁市"],"3811":["3811","海东地区"],"3812":["3812","海北藏族自治州"],"3813":["3813","黄南藏族自治州"],"3814":["3814","海南藏族自治州"],"3815":["3815","果洛藏族自治州"],"3816":["3816","玉树藏族自治州"],"3817":["3817","海西蒙古族藏族自治州"]},"39":{"3910":["3910","银川市"],"3911":["3911","石嘴山市"],"3912":["3912","吴忠市"],"3913":["3913","固原市"],"3914":["3914","中卫市"]},"40":{"4010":["4010","乌鲁木齐市"],"4011":["4011","克拉玛依市"],"4012":["4012","吐鲁番地区"],"4013":["4013","哈密地区"],"4014":["4014","昌吉回族自治州"],"4015":["4015","博尔塔拉蒙古自治州"],"4016":["4016","巴音郭楞蒙古自治州"],"4017":["4017","阿克苏地区"],"4018":["4018","克孜勒苏柯尔克孜自治州"],"4019":["4019","喀什地区"],"4020":["4020","和田地区"],"4021":["4021","伊犁哈萨克自治州"],"4022":["4022","塔城地区"],"4023":["4023","阿勒泰地区"],"4024":["4024","石河子市"],"4025":["4025","阿拉尔市"],"4026":["4026","图木舒克市"],"4027":["4027","五家渠市"]},"41":{"4110":["4110","台北市"],"4111":["4111","高雄市"],"4112":["4112","基隆市"],"4113":["4113","台中市"],"4114":["4114","台南市"],"4115":["4115","新竹市"],"4116":["4116","嘉义市"],"4117":["4117","台北县"],"4118":["4118","宜兰县"],"4119":["4119","桃园县"],"4120":["4120","新竹县"],"4121":["4121","苗栗县"],"4122":["4122","台中县"],"4123":["4123","彰化县"],"4124":["4124","南投县"],"4125":["4125","云林县"],"4126":["4126","嘉义县"],"4127":["4127","台南县"],"4128":["4128","高雄县"],"4129":["4129","屏东县"],"4130":["4130","澎湖县"],"4131":["4131","台东县"],"4132":["4132","花莲县"]},"42":{"4210":["4210","中西区"],"4211":["4211","东区"],"4212":["4212","九龙城区"],"4213":["4213","观塘区"],"4214":["4214","南区"],"4215":["4215","深水埗区"],"4216":["4216","黄大仙区"],"4217":["4217","湾仔区"],"4218":["4218","油尖旺区"],"4219":["4219","离岛区"],"4220":["4220","葵青区"],"4221":["4221","北区"],"4222":["4222","西贡区"],"4223":["4223","沙田区"],"4224":["4224","屯门区"],"4225":["4225","大埔区"],"4226":["4226","荃湾区"],"4227":["4227","元朗区"]},"43":{"4310":["4310","澳门特别行政区"]},"44":{"4410":["4410","美国"],"4411":["4411","加拿大"],"4412":["4412","澳大利亚"],"4413":["4413","新西兰"],"4414":["4414","英国"],"4415":["4415","法国"],"4416":["4416","德国"],"4417":["4417","捷克"],"4418":["4418","荷兰"],"4419":["4419","瑞士"],"4420":["4420","希腊"],"4421":["4421","挪威"],"4422":["4422","瑞典"],"4423":["4423","丹麦"],"4424":["4424","芬兰"],"4425":["4425","爱尔兰"],"4426":["4426","奥地利"],"4427":["4427","意大利"],"4428":["4428","乌克兰"],"4429":["4429","俄罗斯"],"4430":["4430","西班牙"],"4431":["4431","韩国"],"4432":["4432","新加坡"],"4433":["4433","马来西亚"],"4434":["4434","印度"],"4435":["4435","泰国"],"4436":["4436","日本"],"4437":["4437","巴西"],"4438":["4438","阿根廷"],"4439":["4439","南非"],"4440":["4440","埃及"]},"45":{"4510":["4510","其他"]}}';
        die;
    }
    
}
